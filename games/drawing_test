<!DOCTYPE html>
<html>
	<head>
		<title>Test of SVG-in-HTML embedding, with scripting!</title>
		<script src="http://code.jquery.com/jquery.min.js"></script>
		<script type="text/javascript">
			$(document).ready(function() {
				var wsurl = "ws://li60-203.members.linode.com/results";
				wsurl = wsurl + "?room=" + encodeURIComponent("{{ room }}");
				wsurl = wsurl + "&name=" + encodeURIComponent("{{ user }}");
				var game_ws = new WebSocket(wsurl);
				
				var svg_ns = "http://www.w3.org/2000/svg";
				var arena = $("#arena"); 
				
				var start_time = (new Date()).getTime();

				var make_target = function (x, y, r) {
					var shape = $(document.createElementNS(svg_ns, "circle"));
					shape.attr("cx", x).attr("cy", y).attr("r", r).attr("class", "target");
					arena.append(shape);
					return shape;
				}
				for (var i=0; i<5; i++) 
				{
				make_target(Math.random()*arena.width(), Math.random()*arena.height(), 10).click(function(evt) {
					evt.target.remove();
					if ($("#arena .target").length == 0) 
					{
					game_ws.send(JSON.stringify({
							"type" : "game result",
							"player" : "{{ user }}",
							"room" : "{{ room }}",
							"game" : "svg test",
							"score" : (new Date()).getTime() - start_time
							}));
					game_ws.close();
					}

				});
				}
			});
		</script>
		<style type="text/css">
			polygon { 
				fill: lime; 
				stroke: purple; 
				stroke-width: 5; 
				fill-rule: evenodd;
			}
			rect {
				fill: green;
			}
			svg {
				border: 1px solid black;
			}
			.target {
				fill: red;
				stroke: black;
				stroke-width: 1;
			}
		</style>
	</head>
	<body>
		<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="300" width="400" id="arena"></svg>
	</body>
</html>
